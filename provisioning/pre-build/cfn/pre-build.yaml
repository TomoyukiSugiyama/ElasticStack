AWSTemplateFormatVersion: 2010-09-09
Description: Pre-build
# ------------------------------------------------------------------------------
# Parameters
# ------------------------------------------------------------------------------
Parameters:
  ProjectName:
    Type: String
    Default: f-iot

# ------------------------------------------------------------------------------
# Resources
# ------------------------------------------------------------------------------
Resources:
  CodeBuildDev:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: code-build.yaml
      Parameters:
        CodeBuildName: !Sub ${ProjectName}-build-dev
        S3CfnBucketParameterKey: /dev/s3/cfn/BucketName
        S3LambdaBucketParameterKey: /dev/s3/lambda/BucketName
        EcrRepogitoryName: dev-repogitory
  CodePipelineDev:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: code-pipeline.yaml
      Parameters:
        ProjectName: !Ref ProjectName
        BranchName: develop
        CodeBuildName: !GetAtt CodeBuildDev.Outputs.CodeBuildName
        CodePipelineName: !Sub ${ProjectName}-pipeline-dev

# ------------------------------------------------------------------------------
# Outputs
# ------------------------------------------------------------------------------
Outputs:
  ProjectName:
    Value: !Ref ProjectName
